{% from 'forms/form_widget.html' import form_header, form_fieldset, form_row, form_footer  %}

<h2 class="page-title">{% trans %}Chat Rooms{% endtrans %}</h2>

{% set chatroom = event_chatroom.chatroom if event_chatroom %}

<div>
    <div class="groupTitle">
        {%- if chatroom -%}
            {% trans %}Edit chatroom{% endtrans %}
        {%- else -%}
            {% trans %}Create chatroom{% endtrans %}
        {%- endif -%}
    </div>

    {{ form_header(id='chatroom-form') }}

    {% call form_fieldset(legend='Chatroom settings') %}
        {% for field in form.visible_fields if field.short_name not in form.event_specific_fields %}
            {{ form_row(field) }}
        {% endfor %}
    {% endcall %}

    {% call form_fieldset(legend='Event settings', description='These settings affect only the current event even if the chatroom is used in multiple events.') %}
        {% for field in form.visible_fields if field.short_name in form.event_specific_fields %}
            {{ form_row(field) }}
        {% endfor %}
    {% endcall %}

    {% call form_footer() %}
        <input class="i-button big highlight" type="submit" value="{% trans %}Save{% endtrans %}">
        <a href="{{ url_for_plugin('.manage_rooms', event) }}" class="i-button big">{% trans %}Cancel{% endtrans %}</a>
    {% endcall %}

    <script>
        $('#chatroom-form').on('submit', function() {
            $('.save-chatroom').prop('disabled', true).blur();
        });

        $('#use_custom_server').on('change', function() {
            var server = $('#custom_server');
            server.prop('disabled', !this.checked);
            if (!this.checked) {
                // Hide the error tooltip in case it is active.
                server.qtip('hide');
                server.parent().parent().removeClass('has-error');
            }
        });

        $(document).ready(function() {
            $('#custom_server').prop('disabled', !$('#use_custom_server').prop('checked'));
        });
    </script>
</div>
